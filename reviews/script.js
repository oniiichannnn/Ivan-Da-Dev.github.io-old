const anime_lists = [
    {
        title: "a certain magical index",
        rating: 9,
        review: "I have finished **all** seasons about A Certain Magical Index. I LOVED IT, it has action, comedy and harem. Not only that but it has adventure too (now you're concept of adventure might be different than mine, adventure in my mind means going to places), every time I look back at this anime, it makes me feel nostalgic. This anime was always entertaining me during quarantine. Tho the reason why I gave it a 9 was because of Index, shes fucking useless but shes fucking funny and cute too. So shes a good character when it comes to anything other than fighting, shes a good support, knowledgeable, annoying, cute and lazy",
        genres: ["magic","comedy","action","harem"],
        img: "index_img.jpg",
        bg: "index_bg.jpg"
    },
    {
        title: "darling in the franxx",
        rating: 10,
        review: "This was the first anime that I watched. Half of it was good. 'U sick bastard how can u not enjoy darling in the franxx', well I prefer the 02 that loves to tease the MC but when they maked up at episode 6 or 7 or 8, 02 completely changed from a teaser to a normal girl, I rated it 10 because the plot is very good lmao. I didn't expect 02 and the MC to be giant spaceships and die together in the end. I ALSO DIDN'T EXPECT THOSE 2 KIDS TO HAVE SEX AND HAVE A BABY HOLY FUC- Oh I lost my composure there. I love it how they use the power system, whats a \"power system\" u ask? For example, 02 has the authority to go wherever she wants and do what she wants. They know what 02 is doing but they can't stop her because shes plays a important role too, I like how 02 keeps saying darling, this anime also feels nostalgic when thinking back",
        genres: ["school","magic","romance","drama","action","ecchi","comedy","science","sci-fi"],
        img: "darling_img.jpg",
        bg: "darling_bg.png"
    },
    {
        title: "the pet girl of sakura hall",
        rating: 6,
        review: "At first I thought this was a slice of life anime that had a little drama and romance in it but NOPE. It had alot of drama and thats one reason why I gave it a 6. The other reason why i gave it a 6 is because theres no romance, I thought the MC would end up with Shina or the orange hair girl but they didn't :ah:",
        genres: ["school","slice of life","comedy","romance","drama","ecchi"],
        img: "tpgosh_img.jpg",
        bg: "tpgosh_bg.jpg"
    },
    {
        title: "plastic memories",
        rating: 10,
        review: "This anime is very good, its the first that make my cry like a little bitch lmao. I thought this was gonna be one of those happy ending animes but NOPE. \"What do u mean its sad? Didn't Isla came back to life at the end?\" no, remember that they mention they recycle used androids in order to save money? Yeah, they recycled (they removed her old memories and personality) Isla and gave tsukasa the recycled Isla, man thats even worse than Isla dying tbh. Why did this anime make me cry but I didn't cry when I watched \"A silent voice\"? Men, because this anime has 13 episodes (13 x 24 minutes = 312 minutes) while A silent voice was just 2 hours (120 minutes) long. Not only that but in a silent voice's ending, no one died while in plastic memories's ending, Isla died, well her old self died. And I wouldn't cry if it wasn't for Isla's last speech at the end, its so fucking sad and plus they added sad music in the background. This anime was rated a 10 because its the first and I hope it isn't the last anime to make me cry. It has a solid plot, solid characters and a good name",
        genres: ["romance","drama","slice of life","science","sci-fi"],
        img: "plamemo_img.png",
        bg: "plamemo_bg.jpg"
    },
    {
        title: "your name",
        rating: 8,
        review: "A lot of people said that this is a sad anime so I decided to watch it, and boy it wasn't sad at all. So basically what the movie is about is that theres a boy named Taki and a girl named Mitsuha, he keeps getting his mind swapped with a girl named Mitsuha, this keeps continuing for a few months, they are from different time stamps, meh I'm too lazy to type the whole description, go view it on MAL or somewhere. Taki finds out that Mitsuha's village is gonna get crushed by a meteor, so to save Mitsuha, **he drinks sake and fucking time trvales back in time** :woa:. Anyways, so Taki and Mitsuha both successfully saves Mitsuha's village by evacuting everyone to a place where the meteor won't hit. HOWEVER, since Mitsuha never died, this causes the butterfly effect, Taki never knew who Mitsuha is. But in the end they met when they were adults and Taki kinda recognizes Mitsuha and they lived happily ever after. Why did I rate it a 8? because it didn't make me cry like I expected it to be and hey, if it weren't for the music, I would've gave it a 5",
        genres: ["romance"],
        img: "your_name_img.jpg",
        bg: "your_name_bg.webp"
    },
    {
        title: "grand blue",
        rating: 9.5,
        review: "This is the best slice of life anime ever. At first I watched this during quarantine because I saw a funny clip on youtube, and boy although the thumbnail of the anime makes u think \"oh this is probaly related to diving\", well NOPE. Although it may look like a diving related anime but the anime is 10% about diving and 90% about naked men drinking. They did a perfect job of adding slice of life and comedy together, the art style just tops it all, they draw really contrasted faces when its comedy time lmao for example: @gb_shocked.jpg@ which makes it 100 times funnier",
        genres: ["slice of life","comedy"],
        img: "gb_img.jpg",
        bg: "gb_bg.png"
    },
    {
        title: "monogatari series",
        rating: 11,
        review: "I started with kizumonogatari, meaning I watched the most brutal scenes among the monogatari series. If you started with kizumonogatari and dropped it because of the brutality, well you can ignore my opinion but you should keep continuing. The monogatari series isn't as brutal as kizu makes it look like. Its really interesting the way they animate and plan the timeline. The monogatari series is the best mystery anime imo, because they don't air the anime according to its plot's timeline, they would randomly air a season and then air another season on a completely different timeline as you can tell from each season's release date. Not only that but what makes it godly to me is the way they animate it, have you ever wondered what a anime with 98% text look like? Well that would be the monogatari series, not only does Araragi talk all the time, but they even add text flash scenes which look like this: @./monogatari_flash_scene.png@ that always irritates me because I would have to go back and pause the video to look what it said (altho I usually ignore them). Well in case you read this and you want to watch the monogatari series according to the order I watched, [press me to watch the monogatari series on a pirated anime website](https://animedao.to/anime/kizumonogatari/)",
        genres: ["ecchi","comedy","adventure","mystery","psychological fiction"],
        img: "monogatari_img.jpg",
        bg: "monogatari_bg.jpg"
    },
    {
        title: "a sister's all you need",
        rating: 8,
        review: "At first I thought this was a anime that's focused on incest and how having a sister is better than having a normal girl. Why? Because the first 5 minutes of the first episode gave me that idea lmao @./asiayn_imouto_naked.jpg@ I was so excited :blush: but then as I watch further, its a normal slice of life anime<br><br>The reason I still kept watching it despite it not being a nude anime, is that it has a perverted cute girl who wants to have sex with her senpai @./asiayn_sniff.jfif@ and that is the reason for why I am alive, not only that but it also has this other cute girl @./asayn_miyako.png@ (shes 21 btw despite having a loli face) and the fan service on this is... @./asiayn_egg_eating.gif@ not to mention I wanna see how the mc reacts when he knows that he had a little sister all along and the plot is not too bad either, in the end when we all thought the mc had a anime adaption for his LN but in reality he is just a replacement",
        genres: ["ecchi","comedy","slice of life","romance","creator's slice of life"],
        img: "asayn_img.jpg",
        bg: "asayn_bg.jpg"
    }
]

/*
 ** word ** - Bold
 :emoji: - Emoji
 [text](link) - Hyperlink
 @ link/path @ - Attachment
*/

const emojis = [
    {
        name: 'hehe',
        img: 'https://cdn.discordapp.com/emojis/792645345216823306.png?v=1'
    },
    {
        name: "nani",
        img: "https://cdn.discordapp.com/emojis/792658889602367538.png?v=1"
    },
    {
        name: "ah",
        img: "https://cdn.discordapp.com/emojis/753937617258545202.png?v=1"
    },
    {
        name: "ded",
        img: "https://cdn.discordapp.com/emojis/806987341889273866.gif?v=1"
    },
    {
        name: "woa",
        img: "https://cdn.discordapp.com/emojis/798246206706417704.png?v=1"
    },
    {
        name: "kaosHehe",
        img: "https://cdn.discordapp.com/emojis/444565473665875990.png?v=1"
    },
    {
        name: 'blush',
        img: 'https://emoji.discord.st/emojis/flandre_joy.png'
    },
    {
        name: 'happy',
        img: 'https://i.imgur.com/8At68hU.png'
    }
]

const linkReg = /https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/g

function load_animes(){
    if(document.URL.includes('https://oniichann.tk/reviews/?anime=')){
        console.log(decodeURL(document.URL).slice('https://oniichann.tk/reviews/?anime='.length))
        if(!anime_lists.find(a => a.title.toLowerCase().includes(decodeURL(document.URL).slice('https://oniichann.tk/reviews/?anime='.length)))) return

        let anime = anime_lists.find(a => a.title.toLowerCase().includes(decodeURL(document.URL).slice('https://oniichann.tk/reviews/?anime='.length)))
        display_anime(anime)
    }

    function decodeURL(url){
        return url.replace(/%20/g,' ')
    }

    if(document.URL.includes('https://oniichann.tk/reviews/?anime=')) return

    anime_lists.sort().forEach(anime => {
        let card = document.createElement("div")
        let img = document.createElement("img")
        let h1 = document.createElement("h1")
        let h2 = document.createElement("h2")

        img.src = `./images/${anime.img}`
        h1.innerHTML = anime.title.replace(/(\b\w)/gi, w => w.toUpperCase())
        h2.innerHTML = `<strong id='card_rating_bigger'>${anime.rating}</strong> / 10`

        document.body.appendChild(card)
        document.body.appendChild(img)
        document.body.appendChild(h1)
        document.body.appendChild(h2)

        card.classList.add("card")
        card.id = anime.title.replace(/ /g,'_')
        card.appendChild(h1)
        card.appendChild(h2)
        card.appendChild(img)

        img.classList.add("card_img")
        h1.classList.add("card_title")
        h2.classList.add("card_ratings")

        Array.from(document.getElementsByClassName("anime_list")).find(e => e.id === anime.title.substring(0,1).toUpperCase())
        .appendChild(card)
    })
}

document.addEventListener("click", function(element){
    if(element.path[1].id === 'view') return
    if(!element.path[1].id) return
    let anime = anime_lists.find(a => a.title === element.path[1].id.replace(/\_/g,' '))
    if(!anime) return

    display_anime(anime)
})

function display_anime(anime){
    let getPage = document.getElementById("view")
    document.getElementById("view_title").innerHTML = toPropercase(anime.title)
    document.getElementById("view_review").innerHTML = anime.review
    .replace(/\*\*[a-zA-Z0-9, \t\n\r]+\*\*/g,function(text){
        return `<strong id='bold'>${text.replace(/\*/g,'')}</strong>`
    })
    .replace('\n','<br>')


    if(/:[a-zA-Z0-9, \t\n\r]+:/g.test(anime.review) === true){
        document.getElementById("view_review").innerHTML =
        document.getElementById("view_review").innerHTML
        .replace(/:[a-zA-Z0-9, \t\n\r]+:/g,function(text){
            let theEmoji = emojis.find(e => e.name.toLowerCase() === text.replace(/:/g,'').toLowerCase())
            return `<span><img class="emoji" src="${theEmoji.img}"></span>`
        })
    }

    const TextLinkReg = /\[[a-zA-Z0-9, \t\n\r]+\]\(https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)\)/g

    if(TextLinkReg.test(anime.review) === true){
        document.getElementById("view_review").innerHTML =
        document.getElementById("view_review").innerHTML
        .replace(TextLinkReg,function(text){
            return `<span><a class="link" href="${text.split('(')[1].split(')')[0]}">${text.split('[')[1].split(']')[0]}</a></span>`
        })
    }

    const imageReg = /(@https?:\/\/(www\.)?[-a-zA-Z0-9:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9():%_\+.~#?&//=]*)\@|@\.\/[a-zA-Z0-9, \w\.(jpe?g|png|gif|bmp|jfif|webp)$]+@)/g
    // const imageReg = /@\.\/images\/[a-zA-Z0-9, \w\.(jpe?g|png|gif|bmp|jfif)$]+@/g

    if(imageReg.test(anime.review) === true){
        document.getElementById("view_review").innerHTML =
        document.getElementById("view_review").innerHTML
        .replace(imageReg,function(text){
            return `<br><br><span class='attachment_ctn'><img class="attachment" src="./images/${text.split('@')[1].split('@')[0]}"></span><br>`
        })
    }

    document.getElementById("view_genres").innerHTML = anime.genres.map(g => `<strong id="genre">${toPropercase(g)}</strong>`).join(' ')
    document.getElementById("view_rating").innerHTML = `<strong id='card_rating_bigger'>${anime.rating}</strong> / 10`

    document.getElementById("view_img").src = `./images/${anime.img}`

    getPage.style.display = 'inherit'
    document.getElementsByClassName('body')[0].style.display = 'none'
    document.getElementsByClassName('head')[0].style.display = 'none'
    document.body.style.backgroundImage = `url(${anime.bg})`
}

function toPropercase(string){
    return string.replace(/(\b\w)/gi, w => w.toUpperCase())
}

function back(){
    document.body.style.backgroundColor = '#28282B'
    document.getElementsByClassName('body')[0].style.display = 'inherit'
    document.getElementsByClassName('head')[0].style.display = 'inherit'

    let getPage = document.getElementById("view")
    getPage.style.display = 'none'
    document.body.style.backgroundImage = `none`
}